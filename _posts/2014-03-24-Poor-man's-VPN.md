---
layout: post
category: 
tagline: 
tags: [vpn, aws, proxy, sshuttle, security, osx]
title: Poor man's VPN
---
{% include JB/setup %}

Some time ago I was wondering about security on open WiFi networks. These network provide no security on the transfer layer and everyone who wants can sniff your traffic that goes freely over the air. If you're browsing over HTTPS it is at least not possible to read the content of the requests, but the target domains can still be read.

A VPN is a way to route all your traffic to the VPN site. There are of course all kinds of expensive tools for this. But another way to just use plain old SSH-tunnelling.

A tool called [Sshuttle](https://github.com/apenwarr/sshuttle) uses this to forward all your traffic in a transparent way to any machine on which you have SSH access.

Install Sshuttle with `brew install sshuttle` and you can connect your vpn with `sshuttle --dns --daemon --pidfile=/tmp/sshuttle.pid --remote=remote.ssh.machine 0/0`.

This can for example connect you to a machine you have at home, or at your office. Effectively all your traffic is encrypted via the SSH connection before it leaves your computer and send onto the internet by the VPN machine, meaning no sniffer on the open WiFi can see what you're sending over the air.

One drawback of this approach is of course the speed loss by depending on multiple connections. Sshuttle does a neat job preventing tcp-over-tcp.

## AWS
If you don't have an SSH server available, you can also use a [free instance of Amazon AWS](https://aws.amazon.com/free/). The only downside is the required credit card. I registered and had a simple free Linux instance running in minutes. 

I used the private key generated by AWS and added the host to my `~/.ssh/config`:

```
Host awsproxy
        HostName AWSIP
        User ec2-user
        IdentityFile ~/.ssh/AWS.pem
```

Now I can connect sshuttle to AWS with: `sshuttle --dns --daemon --pidfile=/tmp/sshuttle.pid --remote=awsproxy 0/0`.
The speed is not ideal, but at least it is safe (as long as you trust Amazon...) and as an extra I can also watch Hulu from outside the US. 

For convenience I also created some Fish shell functions to create and destroy the tunnel/vpn:

```fish
function tunnelaws
  sshuttle --dns --daemon --pidfile=/tmp/sshuttle.pid --remote=awsproxy 0/0
end

function tunnelx
         if test -f /tmp/sshuttle.pid
            kill (cat /tmp/sshuttle.pid)
            echo "Disconnected."
         end
end
```